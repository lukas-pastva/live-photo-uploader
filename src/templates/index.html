{% extends 'base.html' %}
{% block content %}
<h1>Categories</h1>
<form action="{{ url_for('create_category') }}" method="post" class="mb-4">
    <div class="form-group">
        <input type="text" name="category_name" class="form-control mb-2" placeholder="New Category" required>
        <button type="submit" class="btn btn-primary btn-lg btn-block">Create Category</button>
    </div>
</form>

<!-- Tree Container -->
<div id="categoryTree"></div>

<!-- Initialize jsTree -->
<script>
$(function() {
    // Convert flat category list to hierarchical data
    const categories = {{ categories | tojson }};
    const treeData = [];

    categories.forEach(category => {
        const parts = category.split('-');
        let currentLevel = treeData;

        parts.forEach((part, index) => {
            let existingNode = currentLevel.find(node => node.text === part);
            if (!existingNode) {
                existingNode = { text: part, children: [] };
                currentLevel.push(existingNode);
            }
            if (index === parts.length - 1) {
                // Add additional data like href for leaf nodes
                existingNode.a_attr = { href: "{{ url_for('category_view', category='') }}" + category };
                existingNode.icon = "jstree-file"; // Optional: Change icon for leaf nodes
            }
            currentLevel = existingNode.children;
        });
    });

    // Initialize jsTree with the hierarchical data
    $('#categoryTree').jstree({
        'core' : {
            'data' : treeData,
            'themes': {
                'responsive': false
            }
        }
    });

    // Handle click event on tree nodes
    $('#categoryTree').on("select_node.jstree", function (e, data) {
        const href = data.node.a_attr.href;
        if (href) {
            window.location.href = href;
        }
    });
});
</script>
{% endblock %}
